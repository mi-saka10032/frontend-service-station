---
title: 进阶技巧
order: 9
category: false
tag:
  - 进阶技巧
  - 扩展API
  - 性能优化
---

## 懒加载`lazy`

`React.lazy` 函数可以动态引入组件

`React.suspense` 支持组件等待加载完成前的加载过程中操作如：loading 加载中... 显示

### 语法

`const OtherComponent = React.lazy(() => import('./OtherComponent'));`

```jsx
import React, { Suspense } from "react";

const OtherComponent = React.lazy(() => import("./OtherComponent"));

function MyComponent() {
  return (
    <div>
      <Suspense fallback={<div>Loading...</div>}>
        <OtherComponent />
      </Suspense>
    </div>
  );
}
```

fallback 属性接受任何在组件加载过程中你想展示的 React 元素。你可以将 Suspense 组件置于懒加载组件之上的任何位置。你甚至可以用一个 Suspense 组件包裹多个懒加载组件。

```jsx
import React, { Suspense } from "react";

const OtherComponent = React.lazy(() => import("./OtherComponent"));
const AnotherComponent = React.lazy(() => import("./AnotherComponent"));

function MyComponent() {
  return (
    <div>
      <Suspense fallback={<div>Loading...</div>}>
        <section>
          <OtherComponent />
          <AnotherComponent />
        </section>
      </Suspense>
    </div>
  );
}
```

### 过渡效果

```jsx
import React, { Suspense, startTransition } from "react";
import Tabs from "./Tabs";
import Glimmer from "./Glimmer";

const Comments = React.lazy(() => import("./Comments"));
const Photos = React.lazy(() => import("./Photos"));

function MyComponent() {
  const [tab, setTab] = React.useState("photos");

  function handleTabSelect(tab) {
    startTransition(() => {
      setTab(tab);
    });
  }

  return (
    <div>
      <Tabs onTabSelect={handleTabSelect} />
      <Suspense fallback={<Glimmer />}>
        {tab === "photos" ? <Photos /> : <Comments />}
      </Suspense>
    </div>
  );
}
```

当 tab 切换时，标签切换为"comments"不会标记为紧急更新，而是标记为需要一些准备时间的 transition，实现一个过渡效果。React 会保留旧的 UI 并进行交互，当它准备好时，会切换为 Comments 组件