<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.53" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="http://localhost:8080/frontend-service-station/webpack/6-vite.html"><meta property="og:site_name" content="前端加油站"><meta property="og:title" content="Vite"><meta property="og:description" content="Vite 是一个由 ESBuild 搭建的快速开发服务器与一套 Rollup 打包器构成的前端构建工具 它基于原生 ES 模块提供了极快的冷启动与模块热更新 基于 Rollup 的预配置，可输出用于生产环境的高度优化过的静态资源 Vite 与 VueCli 和 Webpack 的对比详见Vite 冷启动 (../vue3/2-创建工程.html#优秀的..."><meta property="og:type" content="article"><meta property="og:updated_time" content="2023-02-14T15:44:59.000Z"><meta property="og:locale" content="zh-CN"><meta property="article:tag" content="Vite"><meta property="article:tag" content="结构分析"><meta property="article:tag" content="构建优化"><meta property="article:modified_time" content="2023-02-14T15:44:59.000Z"><link rel="icon" href="/frontend-service-station/favicon.ico"><link rel="icon" href="/frontend-service-station/misaka10032.png" type="image/png" sizes="512x512"><link rel="manifest" href="/frontend-service-station/manifest.webmanifest" crossorigin="use-credentials"><meta name="theme-color" content="#46bd87"><link rel="apple-touch-icon" href="/frontend-service-station/misaka10032.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="msapplication-TileImage" content="/frontend-service-station/misaka10032.png"><meta name="msapplication-TileColor" content="#46bd87"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"><title>Vite | 前端加油站</title><meta name="description" content="Vite 是一个由 ESBuild 搭建的快速开发服务器与一套 Rollup 打包器构成的前端构建工具 它基于原生 ES 模块提供了极快的冷启动与模块热更新 基于 Rollup 的预配置，可输出用于生产环境的高度优化过的静态资源 Vite 与 VueCli 和 Webpack 的对比详见Vite 冷启动 (../vue3/2-创建工程.html#优秀的...">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d2025;
      }

      html,
      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.querySelector("html").setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="preload" href="/frontend-service-station/assets/style.ac40b8f0.css" as="style" /><link rel="stylesheet" href="/frontend-service-station/assets/style.ac40b8f0.css" />
    <link rel="modulepreload" href="/frontend-service-station/assets/app.72a63fa9.js"><link rel="modulepreload" href="/frontend-service-station/assets/6-vite.html.f7bb6d22.js"><link rel="modulepreload" href="/frontend-service-station/assets/_plugin-vue_export-helper.cdc0426e.js"><link rel="modulepreload" href="/frontend-service-station/assets/6-vite.html.8b51a6fa.js">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">跳至主要內容</a><!--]--><div class="theme-container has-toc"><!--[--><!--[--><header class="navbar"><div class="navbar-left"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><a href="/frontend-service-station/" class="brand"><img class="logo" src="/frontend-service-station/misaka10032.png" alt="前端加油站"><!----><span class="site-name hide-in-pad">前端加油站</span></a><!--[--><!----><!--]--></div><div class="navbar-center"><!--[--><!----><!--]--><nav class="nav-links"><div class="nav-item hide-in-mobile"><a href="/frontend-service-station/" class="nav-link" aria-label="首页"><span class="icon iconfont icon-home"></span>首页<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="基础"><span class="title"><span class="icon iconfont icon-enum"></span>基础</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/frontend-service-station/base/html/HTML%E5%9F%BA%E7%A1%80.html" class="nav-link" aria-label="HTML"><span class="icon iconfont icon-html"></span>HTML<!----></a></li><li class="dropdown-item"><a href="/frontend-service-station/base/css/CSS%E5%9F%BA%E7%A1%80.html" class="nav-link" aria-label="CSS"><span class="icon iconfont icon-css"></span>CSS<!----></a></li><li class="dropdown-item"><a href="/frontend-service-station/base/javascript" class="nav-link" aria-label="Javascript"><span class="icon iconfont icon-javascript"></span>Javascript<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="框架"><span class="title"><span class="icon iconfont icon-frame"></span>框架</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/frontend-service-station/vue2/1-%E7%AE%80%E4%BB%8B.html" class="nav-link" aria-label="Vue2"><span class="icon iconfont icon-vue"></span>Vue2<!----></a></li><li class="dropdown-item"><a href="/frontend-service-station/vue3/1-%E7%AE%80%E4%BB%8B.html" class="nav-link" aria-label="Vue3"><span class="icon iconfont icon-vue"></span>Vue3<!----></a></li><li class="dropdown-item"><a href="/frontend-service-station/react/1-%E7%AE%80%E4%BB%8B.html" class="nav-link" aria-label="React"><span class="icon iconfont icon-react"></span>React<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="构建工具"><span class="title"><span class="icon iconfont icon-build"></span>构建工具</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/frontend-service-station/webpack/2-primary.html" class="nav-link" aria-label="Webpack"><span class="icon iconfont icon-view"></span>Webpack<!----></a></li><li class="dropdown-item"><a href="/frontend-service-station/webpack/5-vuecli.html" class="nav-link" aria-label="VueCli"><span class="icon iconfont icon-vue"></span>VueCli<!----></a></li><li class="dropdown-item"><a aria-current="page" href="/frontend-service-station/webpack/6-vite.html" class="router-link-active router-link-exact-active nav-link active" aria-label="Vite"><span class="icon iconfont icon-valine"></span>Vite<!----></a></li><li class="dropdown-item"><a href="/frontend-service-station/webpack/8-umi.html" class="nav-link" aria-label="Umi"><span class="icon iconfont icon-react"></span>Umi<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="性能优化"><span class="title"><span class="icon iconfont icon-launch"></span>性能优化</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/frontend-service-station/performance/2-interactive.html" class="nav-link" aria-label="界面交互"><span class="icon iconfont icon-chrome"></span>界面交互<!----></a></li><li class="dropdown-item"><a href="/frontend-service-station/performance/3-target.html" class="nav-link" aria-label="性能指标"><span class="icon iconfont icon-ability"></span>性能指标<!----></a></li><li class="dropdown-item"><a href="/frontend-service-station/performance/5-cache.html" class="nav-link" aria-label="缓存技术"><span class="icon iconfont icon-cache"></span>缓存技术<!----></a></li><li class="dropdown-item"><a href="/frontend-service-station/performance/6-nginx.html" class="nav-link" aria-label="Nginx"><span class="icon iconfont icon-nginx"></span>Nginx<!----></a></li></ul></button></div></div></nav><!--[--><!----><!--]--></div><div class="navbar-right"><!--[--><!----><!--]--><!----><div class="nav-item"><a class="repo-link" href="https://github.com/mi-saka10032/frontend-service-station" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!--[--><button class="search-pro-button" role="search" aria-label="搜索"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg></button><!--]--><!--[--><!----><!--]--><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow left"></span></div><aside class="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><!--[--><a href="/frontend-service-station/" class="nav-link sidebar-link sidebar-page" aria-label="首页"><span class="icon iconfont icon-home"></span>首页<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-ajax"></span><span class="title">AJAX</span><span class="arrow right"></span></button><!----></section></li><li><!--[--><a href="/frontend-service-station/git.html" class="nav-link sidebar-link sidebar-page" aria-label="Git"><span class="icon iconfont icon-git"></span>Git<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-nodeJS"></span><span class="title">Node</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-react"></span><span class="title">React</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-preview"></span><span class="title">React源码分析</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-typescript"></span><span class="title">TypeScript</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-vue"></span><span class="title">Vue2</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-vue"></span><span class="title">Vue3</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-preview"></span><span class="title">Vue源码分析</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-enum"></span><span class="title">前端三剑客</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-page"></span><span class="title">前端渲染模式</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-process"></span><span class="title">前端设计模式</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-customize"></span><span class="title">微前端</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-launch"></span><span class="title">性能优化</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable active"><span class="icon iconfont icon-build"></span><span class="title">构建工具</span><span class="arrow down"></span></button><ul class="sidebar-links"><li><!--[--><a href="/frontend-service-station/webpack/1-preface.html" class="nav-link sidebar-link sidebar-page" aria-label="前言"><!---->前言<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/frontend-service-station/webpack/2-primary.html" class="nav-link sidebar-link sidebar-page" aria-label="webpack基础配置"><!---->webpack基础配置<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/frontend-service-station/webpack/3-senior.html" class="nav-link sidebar-link sidebar-page" aria-label="webpack进阶配置"><!---->webpack进阶配置<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/frontend-service-station/webpack/4-webpack%E5%8E%9F%E7%90%86.html" class="nav-link sidebar-link sidebar-page" aria-label="Webpack原理"><!---->Webpack原理<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/frontend-service-station/webpack/5-vuecli.html" class="nav-link sidebar-link sidebar-page" aria-label="VueCli"><!---->VueCli<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-current="page" href="/frontend-service-station/webpack/6-vite.html" class="router-link-active router-link-exact-active nav-link active sidebar-link sidebar-page active" aria-label="Vite"><!---->Vite<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/frontend-service-station/webpack/6-vite.html#安装与创建" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="安装与创建"><!---->安装与创建<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/frontend-service-station/webpack/6-vite.html#安装包" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="安装包"><!---->安装包<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/frontend-service-station/webpack/6-vite.html#创建新项目" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="创建新项目"><!---->创建新项目<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/frontend-service-station/webpack/6-vite.html#目录结构" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="目录结构"><!---->目录结构<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/frontend-service-station/webpack/6-vite.html#静态资源" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="静态资源"><!---->静态资源<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/frontend-service-station/webpack/6-vite.html#静态资源路径" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="静态资源路径"><!---->静态资源路径<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/frontend-service-station/webpack/6-vite.html#public" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="public"><!---->public<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/frontend-service-station/webpack/6-vite.html#new-url" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="new URL"><!---->new URL<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/frontend-service-station/webpack/6-vite.html#css-相关" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="css 相关"><!---->css 相关<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/frontend-service-station/webpack/6-vite.html#postcss" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="PostCSS"><!---->PostCSS<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/frontend-service-station/webpack/6-vite.html#modules" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Modules"><!---->Modules<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/frontend-service-station/webpack/6-vite.html#全局变量" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="全局变量"><!---->全局变量<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/frontend-service-station/webpack/6-vite.html#模式和环境变量" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="模式和环境变量"><!---->模式和环境变量<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/frontend-service-station/webpack/6-vite.html#模式" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="模式"><!---->模式<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/frontend-service-station/webpack/6-vite.html#环境变量" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="环境变量"><!---->环境变量<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/frontend-service-station/webpack/6-vite.html#env文件" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label=".env文件"><!---->.env文件<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/frontend-service-station/webpack/6-vite.html#构建优化" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="构建优化"><!---->构建优化<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/frontend-service-station/webpack/6-vite.html#按需导入" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="按需导入"><!---->按需导入<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/frontend-service-station/webpack/6-vite.html#分包策略" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="分包策略"><!---->分包策略<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/frontend-service-station/webpack/6-vite.html#静态资源-1" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="静态资源"><!---->静态资源<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/frontend-service-station/webpack/6-vite.html#关闭配置项" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="关闭配置项"><!---->关闭配置项<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/frontend-service-station/webpack/6-vite.html#低版本浏览器兼容" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="低版本浏览器兼容"><!---->低版本浏览器兼容<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/frontend-service-station/webpack/6-vite.html#启用-gzip-压缩" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="启用 gzip 压缩"><!---->启用 gzip 压缩<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/frontend-service-station/webpack/6-vite.html#配置-cdn" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="配置 CDN"><!---->配置 CDN<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li></ul><!--]--></li><li><!--[--><a href="/frontend-service-station/webpack/7-vite%E5%8E%9F%E7%90%86.html" class="nav-link sidebar-link sidebar-page" aria-label="Vite原理"><!---->Vite原理<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/frontend-service-station/webpack/8-umi.html" class="nav-link sidebar-link sidebar-page" aria-label="Umi"><!---->Umi<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><!---->Vite</h1><div class="page-info"><span class="author-info" aria-label="作者🖊" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="author-item" href="https://github.com/mi-saka10032?tab=repositories" target="_blank" rel="noopener noreferrer">Misaka10032</a></span><span property="author" content="Misaka10032"></span></span><!----><span class="date-info" aria-label="写作日期📅" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2023-02-14T01:17:20.000Z"></span><!----><span aria-label="标签🏷" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><ul class="tags-wrapper"><li><span class="tag tag7" role>Vite</span></li><li><span class="tag tag7" role>结构分析</span></li><li><span class="tag tag4" role>构建优化</span></li></ul><meta property="keywords" content="Vite,结构分析,构建优化"></span><span class="reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 9 分钟</span><meta property="timeRequired" content="PT9M"></span></div><hr></div><div class="toc-place-holder"><aside id="toc"><div class="toc-header">此页内容</div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/frontend-service-station/webpack/6-vite.html#安装与创建" class="router-link-active router-link-exact-active toc-link level2">安装与创建</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/frontend-service-station/webpack/6-vite.html#安装包" class="router-link-active router-link-exact-active toc-link level3">安装包</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/frontend-service-station/webpack/6-vite.html#创建新项目" class="router-link-active router-link-exact-active toc-link level3">创建新项目</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/frontend-service-station/webpack/6-vite.html#目录结构" class="router-link-active router-link-exact-active toc-link level2">目录结构</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/frontend-service-station/webpack/6-vite.html#静态资源" class="router-link-active router-link-exact-active toc-link level2">静态资源</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/frontend-service-station/webpack/6-vite.html#静态资源路径" class="router-link-active router-link-exact-active toc-link level3">静态资源路径</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/frontend-service-station/webpack/6-vite.html#public" class="router-link-active router-link-exact-active toc-link level3">public</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/frontend-service-station/webpack/6-vite.html#new-url" class="router-link-active router-link-exact-active toc-link level3">new URL</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/frontend-service-station/webpack/6-vite.html#css-相关" class="router-link-active router-link-exact-active toc-link level2">css 相关</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/frontend-service-station/webpack/6-vite.html#postcss" class="router-link-active router-link-exact-active toc-link level3">PostCSS</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/frontend-service-station/webpack/6-vite.html#modules" class="router-link-active router-link-exact-active toc-link level3">Modules</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/frontend-service-station/webpack/6-vite.html#全局变量" class="router-link-active router-link-exact-active toc-link level3">全局变量</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/frontend-service-station/webpack/6-vite.html#模式和环境变量" class="router-link-active router-link-exact-active toc-link level2">模式和环境变量</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/frontend-service-station/webpack/6-vite.html#模式" class="router-link-active router-link-exact-active toc-link level3">模式</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/frontend-service-station/webpack/6-vite.html#环境变量" class="router-link-active router-link-exact-active toc-link level3">环境变量</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/frontend-service-station/webpack/6-vite.html#env文件" class="router-link-active router-link-exact-active toc-link level3">.env文件</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/frontend-service-station/webpack/6-vite.html#构建优化" class="router-link-active router-link-exact-active toc-link level2">构建优化</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/frontend-service-station/webpack/6-vite.html#按需导入" class="router-link-active router-link-exact-active toc-link level3">按需导入</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/frontend-service-station/webpack/6-vite.html#分包策略" class="router-link-active router-link-exact-active toc-link level3">分包策略</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/frontend-service-station/webpack/6-vite.html#静态资源-1" class="router-link-active router-link-exact-active toc-link level3">静态资源</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/frontend-service-station/webpack/6-vite.html#关闭配置项" class="router-link-active router-link-exact-active toc-link level3">关闭配置项</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/frontend-service-station/webpack/6-vite.html#低版本浏览器兼容" class="router-link-active router-link-exact-active toc-link level3">低版本浏览器兼容</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/frontend-service-station/webpack/6-vite.html#启用-gzip-压缩" class="router-link-active router-link-exact-active toc-link level3">启用 gzip 压缩</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/frontend-service-station/webpack/6-vite.html#配置-cdn" class="router-link-active router-link-exact-active toc-link level3">配置 CDN</a></li><!----><!--]--></ul><!--]--></ul></div></aside></div><!----><div class="theme-hope-content"><p>Vite 是一个由 ESBuild 搭建的快速开发服务器与一套 Rollup 打包器构成的前端构建工具</p><p>它基于原生 ES 模块提供了极快的冷启动与模块热更新</p><p>基于 Rollup 的预配置，可输出用于生产环境的高度优化过的静态资源</p><p>Vite 与 VueCli 和 Webpack 的对比详见<a href="/frontend-service-station/vue3/2-%E5%88%9B%E5%BB%BA%E5%B7%A5%E7%A8%8B.html#%E4%BC%98%E7%A7%80%E7%9A%84%E5%86%B7%E5%90%AF%E5%8A%A8" class="">Vite 冷启动</a></p><h2 id="安装与创建" tabindex="-1"><a class="header-anchor" href="#安装与创建" aria-hidden="true">#</a> 安装与创建</h2><h3 id="安装包" tabindex="-1"><a class="header-anchor" href="#安装包" aria-hidden="true">#</a> 安装包</h3><p>注意：Vite 需要 Node 版本 14.18+，16+；并且不支持 IE 和其他不支持原生 ESM 的浏览器版本</p><!----><h3 id="创建新项目" tabindex="-1"><a class="header-anchor" href="#创建新项目" aria-hidden="true">#</a> 创建新项目</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">npm</span> create vite
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>根据自己的情况选用技术栈</p><p><img src="https://misaka10032.oss-cn-chengdu.aliyuncs.com/Webpack/vue-cli.png" alt="ViteCli" loading="lazy"></p><h2 id="目录结构" tabindex="-1"><a class="header-anchor" href="#目录结构" aria-hidden="true">#</a> 目录结构</h2><p><img src="https://misaka10032.oss-cn-chengdu.aliyuncs.com/Webpack/vite-structure.jpg" alt="ViteStructure" loading="lazy"></p><p>除了项目根目录新增的一些 ts 配置文件和其他插件配置文件之外，Vite 的项目结构大体与 VueCli 相同</p><p>有一处例外，index.html 的存放路径变更为根目录</p><p>其他文件夹的作用详见<a href="/frontend-service-station/webpack/vuecli.html#%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84" class="">VueCli 目录结构</a></p><h2 id="静态资源" tabindex="-1"><a class="header-anchor" href="#静态资源" aria-hidden="true">#</a> 静态资源</h2><p>注意：index.html 位置现在在项目根路径上</p><h3 id="静态资源路径" tabindex="-1"><a class="header-anchor" href="#静态资源路径" aria-hidden="true">#</a> 静态资源路径</h3><ul><li>如果 URL 是一个绝对路径，那么编译时会从项目根目录开始寻找</li><li>如果 URL 以 <code>.</code> 开头，选择相对路径从当前模块的路径开始，基于文件系统中的目录进行解析</li></ul><p>以一个 demo 为例，假设当前项目有一个位于<code>src/component/Demo.vue</code>的文件，一个<code>src/assets/vue.svg</code>的图片</p><p>::: code-tabs:js</p><template><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">import</span> img <span class="token keyword">from</span> <span class="token string">&quot;../assets/vue.svg&quot;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></template><template><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">import</span> img <span class="token keyword">from</span> <span class="token string">&quot;/assets/vue.svg&quot;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>:::</p><p>以上两种写法均能正确编译</p><p>下面是一些其他路径的导入方式</p><h4 id="显式-url-引入" tabindex="-1"><a class="header-anchor" href="#显式-url-引入" aria-hidden="true">#</a> 显式 URL 引入</h4><p>未包含在引入资源内的其他资源，可以使用<code>?url</code>后缀显式导入为一个 url，表示是从外部链接导入的内容</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">import</span> workletURL <span class="token keyword">from</span> <span class="token string">&quot;extra-scalloped-border/worklet.js?url&quot;</span><span class="token punctuation">;</span>
<span class="token constant">CSS</span><span class="token punctuation">.</span>paintWorklet<span class="token punctuation">.</span><span class="token function">addModule</span><span class="token punctuation">(</span>workletURL<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="将资源引入为字符串" tabindex="-1"><a class="header-anchor" href="#将资源引入为字符串" aria-hidden="true">#</a> 将资源引入为字符串</h4><p>资源可以使用 ?raw 后缀声明作为字符串引入。</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">import</span> shaderString <span class="token keyword">from</span> <span class="token string">&quot;./shader.glsl?raw&quot;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="导入脚本作为-worker" tabindex="-1"><a class="header-anchor" href="#导入脚本作为-worker" aria-hidden="true">#</a> 导入脚本作为 Worker</h4><p>脚本可以通过<code>?worker</code>或<code>?sharedworker</code>后缀导入为 web worker</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// 在生产构建中将会分离出 chunk</span>
<span class="token keyword">import</span> Worker <span class="token keyword">from</span> <span class="token string">&quot;./shader.js?worker&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> worker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// sharedworker</span>
<span class="token keyword">import</span> SharedWorker <span class="token keyword">from</span> <span class="token string">&quot;./shader.js?sharedworker&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> sharedWorker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SharedWorker</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// 内联为 base64 字符串</span>
<span class="token keyword">import</span> InlineWorker <span class="token keyword">from</span> <span class="token string">&quot;./shader.js?worker&amp;inline&quot;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="public" tabindex="-1"><a class="header-anchor" href="#public" aria-hidden="true">#</a> public</h3><p>该 public 的功能跟 VueCli 中的 public 别无二致，大多都是用来存储</p><ul><li>不会被源码引用</li><li>必须保持原有文件名（没有 hash）</li><li>不想引入该资源，只想得到 URL</li></ul><p>这些情况下的资源可以考虑放在 public 中，并且在开发时直接通过 <code>/</code> 根路径访问到，打包时能完整复制到目标目录的根目录下</p><p>注意：</p><ol><li>开发时在代码中使用的 <code>/</code> 根路径为编译时根目录，指向项目根目录</li><li>在项目运行时，代码执行 <code>/</code> 根路径查找时是运行时根目录，与 public 目录同一指向，刚才提到的资源可以调取</li></ol><h3 id="new-url" tabindex="-1"><a class="header-anchor" href="#new-url" aria-hidden="true">#</a> <code>new URL</code></h3><p>i<wbr>mport.meta.url 是一个 ESM 的原生功能，会暴露当前模块的 URL。将它与原生的 URL 构造器 组合使用，在一个 JavaScript 模块中，通过相对路径我们就能得到一个被完整解析的静态资源 URL：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> imgUrl <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span><span class="token string">&quot;./img.png&quot;</span><span class="token punctuation">,</span> <span class="token keyword">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span>href<span class="token punctuation">;</span>

document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;hero-img&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>src <span class="token operator">=</span> imgUrl<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在生产构建时，Vite 才会进行必要的转换保证 URL 在打包和资源哈希后仍指向正确的地址。然而，这个 URL 字符串必须是静态的，这样才好分析。否则代码将被原样保留、因而在 build.target 不支持 i<wbr>mport.meta.url 时会导致运行时错误。</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// Vite 不会转换这个</span>
<span class="token keyword">const</span> imgUrl <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span>imagePath<span class="token punctuation">,</span> <span class="token keyword">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span>href<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="css-相关" tabindex="-1"><a class="header-anchor" href="#css-相关" aria-hidden="true">#</a> css 相关</h2><p>Vite 的 css，包括与编译器在内，也都支持自动导入与 HMR</p><h3 id="postcss" tabindex="-1"><a class="header-anchor" href="#postcss" aria-hidden="true">#</a> PostCSS</h3><p>如果项目包含有效的 PostCSS 配置 (任何受 postcss-load-config 支持的格式，例如 postcss.config.js)，它将会自动应用于所有已导入的 CSS。</p><p>请注意，CSS 最小化压缩将在 PostCSS 之后运行，并会使用 build.cssTarget 选项。</p><h3 id="modules" tabindex="-1"><a class="header-anchor" href="#modules" aria-hidden="true">#</a> Modules</h3><p>任何以 .module.css 为后缀名的 CSS 文件都被认为是一个 CSS modules 文件。导入这样的文件会返回一个相应的模块对象：</p><div class="language-css line-numbers-mode" data-ext="css"><pre class="language-css"><code><span class="token comment">/* example.module.css */</span>
<span class="token selector">.red</span> <span class="token punctuation">{</span>
  <span class="token property">color</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">import</span> classes <span class="token keyword">from</span> <span class="token string">&quot;./example.module.css&quot;</span><span class="token punctuation">;</span>
document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>className <span class="token operator">=</span> classes<span class="token punctuation">.</span>red<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="全局变量" tabindex="-1"><a class="header-anchor" href="#全局变量" aria-hidden="true">#</a> 全局变量</h3><p>指定传递给 CSS 预处理器的选项。文件扩展名用作选项的键，例如：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">css</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">preprocessorOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">scss</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token comment">// 全局引入变量// 给导入的路径最后加上 ;</span>
        <span class="token literal-property property">additionalData</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">@import &#39;@/assets/css/variable.scss&#39;;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="模式和环境变量" tabindex="-1"><a class="header-anchor" href="#模式和环境变量" aria-hidden="true">#</a> 模式和环境变量</h2><h3 id="模式" tabindex="-1"><a class="header-anchor" href="#模式" aria-hidden="true">#</a> 模式</h3><p>默认情况下，开发服务器运行在 development 模式，而 build 运行在 production 模式，这一点沿用 webpack 设定</p><p>这意味着当执行 vite build 时，它会自动加载 .env.production 中可能存在的环境变量：</p><div class="language-env line-numbers-mode" data-ext="env"><pre class="language-env"><code># .env.production
VITE_APP_TITLE=My App
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>在你的应用中，你可以使用 i<wbr>mport.meta.env.VITE_APP_TITLE 渲染标题。</p><p>在某些情况下，若想在 vite build 时运行不同的模式来渲染不同的标题，你可以通过传递 --mode 选项标志来覆盖命令使用的默认模式。例如，如果你想在 staging （预发布）模式下构建应用</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>vite build <span class="token parameter variable">--mode</span> staging
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>还需要新建一个 .env.staging 文件：</p><div class="language-env line-numbers-mode" data-ext="env"><pre class="language-env"><code># .env.staging
VITE_APP_TITLE=My App (staging)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>由于 vite build 默认运行生产模式构建，你也可以通过使用不同的模式和对应的 .env 文件配置来改变它，用以运行开发模式的构建：</p><div class="language-env line-numbers-mode" data-ext="env"><pre class="language-env"><code># .env.testing
NODE_ENV=development
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>模式切换逻辑 Vite 整体和 Webpack 一样</p><h3 id="环境变量" tabindex="-1"><a class="header-anchor" href="#环境变量" aria-hidden="true">#</a> 环境变量</h3><p>Vite 在一个特殊的 i<wbr>mport.meta.env 对象上暴露环境变量。这里有一些在所有情况下都可以使用的内建变量：</p><ul><li><p>i<wbr>mport.meta.env.MODE: {string} 应用运行的模式。</p></li><li><p>i<wbr>mport.meta.env.BASE_URL: {string} 部署应用时的基本 URL。他由 base 配置项决定。</p></li><li><p>i<wbr>mport.meta.env.PROD: {boolean} 应用是否运行在生产环境。</p></li><li><p>i<wbr>mport.meta.env.DEV: {boolean} 应用是否运行在开发环境 (永远与 i<wbr>mport.meta.env.PROD 相反)。</p></li><li><p>i<wbr>mport.meta.env.SSR: {boolean} 应用是否运行在 server 上。</p></li></ul><p>在生产环境中，这些环境变量会在构建时被静态替换，因此，在引用它们时请使用完全静态的字符串。动态的 key 将无法生效。例如，动态 key 取值 <code>i<wbr>mport.meta.env[key]</code> 是无效的。</p><h3 id="env文件" tabindex="-1"><a class="header-anchor" href="#env文件" aria-hidden="true">#</a> <code>.env</code>文件</h3><p>同样的，Vite 使用<a href="https://github.com/motdotla/dotenv" target="_blank" rel="noopener noreferrer">dotenv<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>从环境目录中的下列文件加载额外的环境变量</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>.env                <span class="token comment"># 所有情况下都会加载</span>
.env.local          <span class="token comment"># 所有情况下都会加载，但会被 git 忽略</span>
.env.<span class="token punctuation">[</span>mode<span class="token punctuation">]</span>         <span class="token comment"># 只在指定模式下加载</span>
.env.<span class="token punctuation">[</span>mode<span class="token punctuation">]</span>.local   <span class="token comment"># 只在指定模式下加载，但会被 git 忽略</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>加载的环境变量也会通过 i<wbr>mport.meta.env 以字符串形式暴露给客户端源码。</p><p>为了防止意外地将一些环境变量泄漏到客户端，只有以 VITE_ 为前缀的变量才会暴露给经过 vite 处理的代码</p><h2 id="构建优化" tabindex="-1"><a class="header-anchor" href="#构建优化" aria-hidden="true">#</a> 构建优化</h2><h3 id="按需导入" tabindex="-1"><a class="header-anchor" href="#按需导入" aria-hidden="true">#</a> 按需导入</h3><p>首先需要明确一点，Vite 基于 rollup 的 tree-shaking 打包，天生支持 ESM 的按需加载，所以使用依赖时要注意第三方依赖是不是支持 ESM</p><p>比如<code>lodash</code>就是默认 CJS 的依赖，即使引入到 Vite 项目中打包后还是很大，这时候就需要使用它的 ESM 版本了<code>lodash-es</code>，使用这个版本的 lodash 库就能正确按需导入了</p><h3 id="分包策略" tabindex="-1"><a class="header-anchor" href="#分包策略" aria-hidden="true">#</a> 分包策略</h3><p>注意 1：Vite2.9 开始需要先引入 splitVendorChunkPlugin 再使用分包配置</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// vite.config.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> splitVendorChunkPlugin <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vite&quot;</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">splitVendorChunkPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>注意 2：Vite 中同样也有代码分割配置，但有点不同的是，如果用户配置了手动分包，就会默认覆盖 Vite 原来提供的 vendor 分包逻辑，会导致打包出现大量的代码碎片</p><p>借用源码中原有的 vendor 逻辑，再结合实际情况，以下分包策略代码仅供参考。参考链接：<a href="https://www.jianshu.com/p/a0845aa1ff07" target="_blank" rel="noopener noreferrer">https://www.jianshu.com/p/a0845aa1ff07<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// vite.config.ts</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token literal-property property">rollupOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token function">manualChunks</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">id</span><span class="token operator">:</span> any<span class="token punctuation">,</span> <span class="token punctuation">{</span> getModuleInfo <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> cssLangs <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">\\.(css|less|sass|scss|styl|stylus|pcss|postcss)($|\\?)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> cssLangRE <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span>cssLangs<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> cache <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SplitVendorChunkCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> isCSSRequest <span class="token operator">=</span> <span class="token punctuation">(</span>request<span class="token operator">:</span> string<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token parameter">boolean</span> <span class="token operator">=&gt;</span>
          cssLangRE<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 分vendor包</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>
          id<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">&quot;node_modules&quot;</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
          <span class="token operator">!</span><span class="token function">isCSSRequest</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
          <span class="token function">staticImportedByEntry</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> getModuleInfo<span class="token punctuation">,</span> cache<span class="token punctuation">.</span>cache<span class="token punctuation">)</span>
        <span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token string">&quot;vendor&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>
          <span class="token comment">// 分manifest包，解决chunk碎片问题</span>
          <span class="token function">getModuleInfo</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">.</span>importers<span class="token punctuation">.</span>length <span class="token operator">+</span>
            <span class="token function">getModuleInfo</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">.</span>dynamicImporters<span class="token punctuation">.</span>length <span class="token operator">&gt;</span>
            <span class="token number">1</span> <span class="token operator">&amp;&amp;</span>
          id<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">&quot;src&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token string">&quot;manifest&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">SplitVendorChunkCache</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>cache <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>cache <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">staticImportedByEntry</span><span class="token punctuation">(</span>
  <span class="token parameter">id<span class="token punctuation">,</span>
  getModuleInfo<span class="token punctuation">,</span>
  cache<span class="token punctuation">,</span>
  importStack <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>cache<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">!</span><span class="token operator">!</span>cache<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>importStack<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    cache<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> mod <span class="token operator">=</span> <span class="token function">getModuleInfo</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>mod<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    cache<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>mod<span class="token punctuation">.</span>isEntry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    cache<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> someImporterIs <span class="token operator">=</span> mod<span class="token punctuation">.</span>importers<span class="token punctuation">.</span><span class="token function">some</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">importer</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
    <span class="token function">staticImportedByEntry</span><span class="token punctuation">(</span>
      importer<span class="token punctuation">,</span>
      getModuleInfo<span class="token punctuation">,</span>
      cache<span class="token punctuation">,</span>
      importStack<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  cache<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> someImporterIs<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> someImporterIs<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="静态资源-1" tabindex="-1"><a class="header-anchor" href="#静态资源-1" aria-hidden="true">#</a> 静态资源</h3><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">build</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">rollupOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">chunkFileNames</span><span class="token operator">:</span> <span class="token string">&quot;js/[name]-[hash].js&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 引入文件名的名称</span>
        <span class="token literal-property property">entryFileNames</span><span class="token operator">:</span> <span class="token string">&quot;js/[name]-[hash].js&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 包的入口文件名称</span>
        <span class="token literal-property property">assetFileNames</span><span class="token operator">:</span> <span class="token string">&quot;[ext]/[name]-[hash].[ext]&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 资源文件像 字体，图片等</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="关闭配置项" tabindex="-1"><a class="header-anchor" href="#关闭配置项" aria-hidden="true">#</a> 关闭配置项</h3><p>这里包含了删除调试和控制台代码</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">build</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">terserOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">compress</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token comment">//生产环境时移除console</span>
        <span class="token literal-property property">drop_console</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token literal-property property">drop_debugger</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">//   关闭文件计算</span>
    <span class="token literal-property property">reportCompressedSize</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token comment">//   关闭生成map文件 可以达到缩小打包体积</span>
    <span class="token literal-property property">sourcemap</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 这个生产环境一定要关闭，不然打包的产物会很大</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="低版本浏览器兼容" tabindex="-1"><a class="header-anchor" href="#低版本浏览器兼容" aria-hidden="true">#</a> 低版本浏览器兼容</h3><p>首先需要安装插件<code>npm i @vitejs/plugin-legacy -D</code></p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">import</span> legacyPlugin <span class="token keyword">from</span> <span class="token string">&#39;@vitejs/plugin-legacy&#39;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token function">legacyPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">targets</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;chrome 52&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;Android &amp;gt; 39&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;iOS &amp;gt;= 10.3&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;iOS &amp;gt;= 10.3&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 需要兼容的目标列表，可以设置多个</span>
      <span class="token literal-property property">additionalLegacyPolyfills</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;regenerator-runtime/runtime&#39;</span><span class="token punctuation">]</span> <span class="token comment">// 面向IE11时需要此插件</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="启用-gzip-压缩" tabindex="-1"><a class="header-anchor" href="#启用-gzip-压缩" aria-hidden="true">#</a> 启用 gzip 压缩</h3><p>安装插件 <code>npm install vite-plugin-compression -D</code></p><p>参数：</p><ul><li>filter：过滤器，对哪些类型的文件进行压缩，默认为/.(js|mjs|json|css|html)$/i</li><li>verbose: true：是否在控制台输出压缩结果，默认为 true</li><li>threshold ：启用压缩的文件大小限制，单位是字节，默认为 0</li><li>disable : false：是否禁用压缩，默认为 false</li><li>deleteOriginFile ：压缩后是否删除原文件，默认为 false</li><li>algorithm ：采用的压缩算法，默认是 gzip</li><li>ext ：生成的压缩包后缀</li></ul><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token function">viteCompression</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">verbose</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token literal-property property">disable</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token literal-property property">threshold</span><span class="token operator">:</span> <span class="token number">10240</span><span class="token punctuation">,</span>
  <span class="token literal-property property">algorithm</span><span class="token operator">:</span> <span class="token string">&quot;gzip&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">ext</span><span class="token operator">:</span> <span class="token string">&quot;.gz&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这里是 nginx.conf 的配置参考</p><div class="language-conf line-numbers-mode" data-ext="conf"><pre class="language-conf"><code>server{
    #gzip
    #开启gzip功能
    gzip on;
    #开启gzip静态压缩功能
    gzip_static on;
    #gzip缓存大小
    gzip_buffers 4 16k;
    #gzip http版本
    gzip_http_version 1.1;
    #gzip 压缩级别 1-10
    gzip_comp_level 5;
    #gzip 压缩类型
    gzip_types text/plain application/javascript text/css application/xml text/javascript application/x-httpd-php image/jpeg image/gif image/png;
    gzip_vary on;
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>最终代码：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">import</span> compressPlugin <span class="token keyword">from</span> <span class="token string">&#39;vite-plugin-compression&#39;</span>

<span class="token comment">// compress: &#39;gzip&#39; | &#39;brotli&#39; | &#39;none&#39;</span>
<span class="token keyword">function</span> <span class="token function">configCompressPlugin</span><span class="token punctuation">(</span><span class="token parameter">isBuild<span class="token punctuation">,</span> compress</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> plugins <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isBuild<span class="token punctuation">)</span> <span class="token keyword">return</span> plugins<span class="token punctuation">;</span>
  <span class="token keyword">const</span> compressList <span class="token operator">=</span> compress<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;,&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>compressList<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">&quot;gzip&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    plugins<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>
      <span class="token function">compressPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">verbose</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token literal-property property">disable</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token literal-property property">threshold</span><span class="token operator">:</span> <span class="token number">10240</span><span class="token punctuation">,</span>
        <span class="token literal-property property">algorithm</span><span class="token operator">:</span> <span class="token string">&quot;gzip&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">ext</span><span class="token operator">:</span> <span class="token string">&quot;.gz&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>compressList<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">&quot;brotli&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    plugins<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>
      <span class="token function">compressPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">verbose</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token literal-property property">disable</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token literal-property property">threshold</span><span class="token operator">:</span> <span class="token number">10240</span><span class="token punctuation">,</span>
        <span class="token literal-property property">algorithm</span><span class="token operator">:</span> <span class="token string">&quot;brotliCompress&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">ext</span><span class="token operator">:</span> <span class="token string">&quot;.br&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> plugins<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> isBuild <span class="token operator">=</span> mode <span class="token operator">===</span> <span class="token string">&#39;production&#39;</span> <span class="token comment">// mode == production</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token operator">...</span><span class="token function">configCompressPlugin</span><span class="token punctuation">(</span>isBuild<span class="token punctuation">,</span> <span class="token string">&#39;gzip&#39;</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="配置-cdn" tabindex="-1"><a class="header-anchor" href="#配置-cdn" aria-hidden="true">#</a> 配置 CDN</h3><p>一般这个功能，仅适用于公司有自己的 cdn 库，否则使用第三方的 cdn 稳定性很难保证</p><p><code>npm install vite-plugin-cdn-import --save-dev</code></p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// vite.config.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> defineConfig <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vite&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> ViteCDNPlugin <span class="token keyword">from</span> <span class="token string">&quot;vite-plugin-cdn-import&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token function">ViteCDNPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">modules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;lodash&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 包名</span>
          <span class="token keyword">var</span><span class="token operator">:</span> <span class="token string">&quot;_&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 对应cdn包导出的变量，如jQuery导出的是$</span>
          <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">&quot;https://cdn.jsdelivr.net/npm/lodash@4.17.21/lodash.min.js&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></template></div><!----><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/mi-saka10032/frontend-service-station/edit/main/demo/theme-docs/src/webpack/6-vite.md" rel="noopener noreferrer" target="_blank" aria-label="Edit this page on GitHub" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->Edit this page on GitHub<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item update-time"><span class="label">上次编辑于: </span><!----></div><div class="meta-item contributors"><span class="label">贡献者: </span><!--[--><!--[--><span class="contributor" title="email: misaka10032@aliyun.com">yuzhihang</span><!--]--><!--]--></div></footer><nav class="page-nav"><a href="/frontend-service-station/webpack/5-vuecli.html" class="nav-link prev" aria-label="VueCli"><div class="hint"><span class="arrow left"></span>上一页</div><div class="link"><!---->VueCli</div></a><a href="/frontend-service-station/webpack/7-vite%E5%8E%9F%E7%90%86.html" class="nav-link next" aria-label="Vite原理"><div class="hint">下一页<span class="arrow right"></span></div><div class="link">Vite原理<!----></div></a></nav><!----><!----><!--]--></main><!--]--><!----><!--]--></div><!--]--><!----><!----><!----><!--]--></div>
    <script type="module" src="/frontend-service-station/assets/app.72a63fa9.js" defer></script>
  </body>
</html>
