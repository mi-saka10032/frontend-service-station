<!DOCTYPE html>
<html lang="en-US" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.53" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="http://localhost:8080/frontend-service-station/webpack/3-senior.html"><meta property="og:site_name" content="前端加油站"><meta property="og:title" content="webpack进阶配置"><meta property="og:description" content="source-map 模式 解释 :---------------------- :------------------------------------------------------------------------------------------------------------ eval 每个 module 会封装到 eval 里..."><meta property="og:type" content="article"><meta property="og:updated_time" content="2023-02-14T01:17:20.000Z"><meta property="og:locale" content="en-US"><meta property="article:tag" content="Webpack"><meta property="article:tag" content="进阶配置"><meta property="article:modified_time" content="2023-02-14T01:17:20.000Z"><link rel="icon" href="/frontend-service-station/favicon.ico"><link rel="icon" href="/frontend-service-station/misaka10032.png" type="image/png" sizes="512x512"><link rel="manifest" href="/frontend-service-station/manifest.webmanifest" crossorigin="use-credentials"><meta name="theme-color" content="#46bd87"><link rel="apple-touch-icon" href="/frontend-service-station/misaka10032.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="msapplication-TileImage" content="/frontend-service-station/misaka10032.png"><meta name="msapplication-TileColor" content="#46bd87"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"><title>webpack进阶配置 | 前端加油站</title><meta name="description" content="source-map 模式 解释 :---------------------- :------------------------------------------------------------------------------------------------------------ eval 每个 module 会封装到 eval 里...">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d2025;
      }

      html,
      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.querySelector("html").setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="preload" href="/frontend-service-station/assets/style.47a2122f.css" as="style" /><link rel="stylesheet" href="/frontend-service-station/assets/style.47a2122f.css" />
    <link rel="modulepreload" href="/frontend-service-station/assets/app.c9ae6438.js"><link rel="modulepreload" href="/frontend-service-station/assets/3-senior.html.7cd0d84f.js"><link rel="modulepreload" href="/frontend-service-station/assets/_plugin-vue_export-helper.cdc0426e.js"><link rel="modulepreload" href="/frontend-service-station/assets/3-senior.html.23227fa0.js">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">Skip to main content</a><!--]--><div class="theme-container has-toc"><!--[--><!--[--><header class="navbar"><div class="navbar-left"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><a href="/frontend-service-station/" class="brand"><img class="logo" src="/frontend-service-station/misaka10032.png" alt="前端加油站"><!----><span class="site-name hide-in-pad">前端加油站</span></a><!--[--><!----><!--]--></div><div class="navbar-center"><!--[--><!----><!--]--><nav class="nav-links"><div class="nav-item hide-in-mobile"><a href="/frontend-service-station/" class="nav-link" aria-label="首页"><span class="icon iconfont icon-home"></span>首页<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="基础"><span class="title"><span class="icon iconfont icon-enum"></span>基础</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/frontend-service-station/base/html/HTML%E5%9F%BA%E7%A1%80.html" class="nav-link" aria-label="HTML"><span class="icon iconfont icon-html"></span>HTML<!----></a></li><li class="dropdown-item"><a href="/frontend-service-station/base/css/CSS%E5%9F%BA%E7%A1%80.html" class="nav-link" aria-label="CSS"><span class="icon iconfont icon-css"></span>CSS<!----></a></li><li class="dropdown-item"><a href="/frontend-service-station/base/javascript" class="nav-link" aria-label="Javascript"><span class="icon iconfont icon-javascript"></span>Javascript<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="框架"><span class="title"><span class="icon iconfont icon-frame"></span>框架</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/frontend-service-station/vue2/1-%E7%AE%80%E4%BB%8B.html" class="nav-link" aria-label="Vue2"><span class="icon iconfont icon-vue"></span>Vue2<!----></a></li><li class="dropdown-item"><a href="/frontend-service-station/vue3/1-%E7%AE%80%E4%BB%8B.html" class="nav-link" aria-label="Vue3"><span class="icon iconfont icon-vue"></span>Vue3<!----></a></li><li class="dropdown-item"><a href="/frontend-service-station/react/1-%E7%AE%80%E4%BB%8B.html" class="nav-link" aria-label="React"><span class="icon iconfont icon-react"></span>React<!----></a></li></ul></button></div></div></nav><!--[--><!----><!--]--></div><div class="navbar-right"><!--[--><!----><!--]--><!----><div class="nav-item"><a class="repo-link" href="https://github.com/mi-saka10032/frontend-service-station" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!----><!--[--><!----><!--]--><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow left"></span></div><aside class="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><!--[--><a href="/frontend-service-station/" class="nav-link sidebar-link sidebar-page" aria-label="首页"><span class="icon iconfont icon-home"></span>首页<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-ajax"></span><span class="title">AJAX</span><span class="arrow right"></span></button><!----></section></li><li><!--[--><a href="/frontend-service-station/git.html" class="nav-link sidebar-link sidebar-page" aria-label="Git"><span class="icon iconfont icon-git"></span>Git<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-nodeJS"></span><span class="title">Node</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-react"></span><span class="title">React</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-typescript"></span><span class="title">TypeScript</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-vue"></span><span class="title">Vue2</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-vue"></span><span class="title">Vue3</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-preview"></span><span class="title">Vue源码分析</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-enum"></span><span class="title">前端三剑客</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-page"></span><span class="title">前端渲染模式</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-customize"></span><span class="title">微前端</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-launch"></span><span class="title">性能优化</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable active"><span class="icon iconfont icon-view"></span><span class="title">构建工具</span><span class="arrow down"></span></button><ul class="sidebar-links"><li><!--[--><a href="/frontend-service-station/webpack/1-preface.html" class="nav-link sidebar-link sidebar-page" aria-label="前言"><!---->前言<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/frontend-service-station/webpack/2-primary.html" class="nav-link sidebar-link sidebar-page" aria-label="webpack基础配置"><!---->webpack基础配置<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-current="page" href="/frontend-service-station/webpack/3-senior.html" class="router-link-active router-link-exact-active nav-link active sidebar-link sidebar-page active" aria-label="webpack进阶配置"><!---->webpack进阶配置<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/frontend-service-station/webpack/3-senior.html#source-map" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="source-map"><!---->source-map<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/frontend-service-station/webpack/3-senior.html#dev-server" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="dev-server"><!---->dev-server<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/frontend-service-station/webpack/3-senior.html#模块热替换与热加载" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="模块热替换与热加载"><!---->模块热替换与热加载<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/frontend-service-station/webpack/3-senior.html#eslint" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="eslint"><!---->eslint<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/frontend-service-station/webpack/3-senior.html#git-hooks-与-husky" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="git-hooks 与 husky"><!---->git-hooks 与 husky<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/frontend-service-station/webpack/3-senior.html#模块与依赖" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="模块与依赖"><!---->模块与依赖<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/frontend-service-station/webpack/3-senior.html#模块路径解析规则" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="模块路径解析规则"><!---->模块路径解析规则<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/frontend-service-station/webpack/3-senior.html#外部扩展-externals" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="外部扩展 externals"><!---->外部扩展 externals<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/frontend-service-station/webpack/3-senior.html#依赖图-dependency-graph" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="依赖图 dependency graph"><!---->依赖图 dependency graph<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/frontend-service-station/webpack/3-senior.html#扩展功能" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="扩展功能"><!---->扩展功能<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/frontend-service-station/webpack/3-senior.html#postcss-与-css-模块" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="PostCSS 与 CSS 模块"><!---->PostCSS 与 CSS 模块<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/frontend-service-station/webpack/3-senior.html#web-worker" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Web Worker"><!---->Web Worker<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/frontend-service-station/webpack/3-senior.html#typescript" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="TypeScript"><!---->TypeScript<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/frontend-service-station/webpack/3-senior.html#多页面配置" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="多页面配置"><!---->多页面配置<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/frontend-service-station/webpack/3-senior.html#tree-shaking-重要" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Tree Shaking（重要）"><!---->Tree Shaking（重要）<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/frontend-service-station/webpack/3-senior.html#渐进式网络应用程序-pwa" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="渐进式网络应用程序 PWA"><!---->渐进式网络应用程序 PWA<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/frontend-service-station/webpack/3-senior.html#shimming-预置依赖" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Shimming 预置依赖"><!---->Shimming 预置依赖<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/frontend-service-station/webpack/3-senior.html#shimming-预置全局变量" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Shimming 预置全局变量"><!---->Shimming 预置全局变量<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/frontend-service-station/webpack/3-senior.html#细粒度-shimming" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="细粒度 Shimming"><!---->细粒度 Shimming<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/frontend-service-station/webpack/3-senior.html#全局-exports" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="全局 exports"><!---->全局 exports<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/frontend-service-station/webpack/3-senior.html#polyfills" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Polyfills"><!---->Polyfills<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/frontend-service-station/webpack/3-senior.html#library-轮子" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="library 轮子"><!---->library 轮子<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/frontend-service-station/webpack/3-senior.html#npm-发布" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="npm 发布"><!---->npm 发布<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/frontend-service-station/webpack/3-senior.html#模块联邦-module-federation" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="模块联邦 Module Federation"><!---->模块联邦 Module Federation<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/frontend-service-station/webpack/3-senior.html#八个通用构建优化" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="八个通用构建优化"><!---->八个通用构建优化<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/frontend-service-station/webpack/3-senior.html#_1-更新到最新版本" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.更新到最新版本"><!---->1.更新到最新版本<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/frontend-service-station/webpack/3-senior.html#_2-将-loader-应用于最少数量的必要模块" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.将 loader 应用于最少数量的必要模块"><!---->2.将 loader 应用于最少数量的必要模块<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/frontend-service-station/webpack/3-senior.html#_3-引导-bootstrap" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3.引导 bootstrap"><!---->3.引导 bootstrap<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/frontend-service-station/webpack/3-senior.html#_4-解析" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="4.解析"><!---->4.解析<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/frontend-service-station/webpack/3-senior.html#_5-小即是快-smaller-faster" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="5.小即是快 smaller = faster"><!---->5.小即是快 smaller = faster<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/frontend-service-station/webpack/3-senior.html#_6-持久化缓存" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="6.持久化缓存"><!---->6.持久化缓存<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/frontend-service-station/webpack/3-senior.html#_7-自定义-plugin-loader" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="7.自定义 plugin/loader"><!---->7.自定义 plugin/loader<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/frontend-service-station/webpack/3-senior.html#_8-progress-plugin" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8.progress plugin"><!---->8.progress plugin<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/frontend-service-station/webpack/3-senior.html#dll" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="DLL"><!---->DLL<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/frontend-service-station/webpack/3-senior.html#worker-池-worker-pool" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="worker 池(worker pool)"><!---->worker 池(worker pool)<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/frontend-service-station/webpack/3-senior.html#开发环境构建性能" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="开发环境构建性能"><!---->开发环境构建性能<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/frontend-service-station/webpack/3-senior.html#增量编译" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="增量编译"><!---->增量编译<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/frontend-service-station/webpack/3-senior.html#内存中编译" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="内存中编译"><!---->内存中编译<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/frontend-service-station/webpack/3-senior.html#stats-tojson-加速" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="stats.toJson 加速"><!---->stats.toJson 加速<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/frontend-service-station/webpack/3-senior.html#devtool" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="devtool"><!---->devtool<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/frontend-service-station/webpack/3-senior.html#避免在生产环境使用-dev-工具" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="避免在生产环境使用 dev 工具"><!---->避免在生产环境使用 dev 工具<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/frontend-service-station/webpack/3-senior.html#最小化-entry-chunk" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="最小化 entry chunk"><!---->最小化 entry chunk<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/frontend-service-station/webpack/3-senior.html#避免额外的优化步骤" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="避免额外的优化步骤"><!---->避免额外的优化步骤<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/frontend-service-station/webpack/3-senior.html#输出结果不携带路径信息" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="输出结果不携带路径信息"><!---->输出结果不携带路径信息<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/frontend-service-station/webpack/3-senior.html#node-js-版本-8-9-10-9-11-1" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Node.js 版本 8.9.10 - 9.11.1"><!---->Node.js 版本 8.9.10 - 9.11.1<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/frontend-service-station/webpack/3-senior.html#typescript-loader" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="TypeScript Loader"><!---->TypeScript Loader<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li></ul><!--]--></li><li><!--[--><a href="/frontend-service-station/webpack/4-webpack%E5%8E%9F%E7%90%86.html" class="nav-link sidebar-link sidebar-page" aria-label="Webpack原理"><!---->Webpack原理<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/frontend-service-station/webpack/5-vuecli.html" class="nav-link sidebar-link sidebar-page" aria-label="VueCli"><!---->VueCli<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/frontend-service-station/webpack/6-vite.html" class="nav-link sidebar-link sidebar-page" aria-label="Vite"><!---->Vite<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/frontend-service-station/webpack/7-vite%E5%8E%9F%E7%90%86.html" class="nav-link sidebar-link sidebar-page" aria-label="Vite原理"><!---->Vite原理<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/frontend-service-station/webpack/8-umi.html" class="nav-link sidebar-link sidebar-page" aria-label="Umi"><!---->Umi<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><!---->webpack进阶配置</h1><div class="page-info"><span class="author-info" aria-label="Author🖊" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="author-item" href="https://github.com/mi-saka10032?tab=repositories" target="_blank" rel="noopener noreferrer">Misaka10032</a></span><span property="author" content="Misaka10032"></span></span><!----><span class="date-info" aria-label="Writing Date📅" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2023-02-14T01:17:20.000Z"></span><!----><span aria-label="Tag🏷" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><ul class="tags-wrapper"><li><span class="tag tag0" role>Webpack</span></li><li><span class="tag tag6" role>进阶配置</span></li></ul><meta property="keywords" content="Webpack,进阶配置"></span><span class="reading-time-info" aria-label="Reading Time⌛" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>About 15 min</span><meta property="timeRequired" content="PT15M"></span></div><hr></div><div class="toc-place-holder"><aside id="toc"><div class="toc-header">On This Page</div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/frontend-service-station/webpack/3-senior.html#source-map" class="router-link-active router-link-exact-active toc-link level2">source-map</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/frontend-service-station/webpack/3-senior.html#dev-server" class="router-link-active router-link-exact-active toc-link level2">dev-server</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/frontend-service-station/webpack/3-senior.html#模块热替换与热加载" class="router-link-active router-link-exact-active toc-link level2">模块热替换与热加载</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/frontend-service-station/webpack/3-senior.html#eslint" class="router-link-active router-link-exact-active toc-link level2">eslint</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/frontend-service-station/webpack/3-senior.html#git-hooks-与-husky" class="router-link-active router-link-exact-active toc-link level2">git-hooks 与 husky</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/frontend-service-station/webpack/3-senior.html#模块与依赖" class="router-link-active router-link-exact-active toc-link level2">模块与依赖</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/frontend-service-station/webpack/3-senior.html#模块路径解析规则" class="router-link-active router-link-exact-active toc-link level3">模块路径解析规则</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/frontend-service-station/webpack/3-senior.html#外部扩展-externals" class="router-link-active router-link-exact-active toc-link level3">外部扩展 externals</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/frontend-service-station/webpack/3-senior.html#依赖图-dependency-graph" class="router-link-active router-link-exact-active toc-link level3">依赖图 dependency graph</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/frontend-service-station/webpack/3-senior.html#扩展功能" class="router-link-active router-link-exact-active toc-link level2">扩展功能</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/frontend-service-station/webpack/3-senior.html#postcss-与-css-模块" class="router-link-active router-link-exact-active toc-link level3">PostCSS 与 CSS 模块</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/frontend-service-station/webpack/3-senior.html#web-worker" class="router-link-active router-link-exact-active toc-link level3">Web Worker</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/frontend-service-station/webpack/3-senior.html#typescript" class="router-link-active router-link-exact-active toc-link level3">TypeScript</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/frontend-service-station/webpack/3-senior.html#多页面配置" class="router-link-active router-link-exact-active toc-link level2">多页面配置</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/frontend-service-station/webpack/3-senior.html#tree-shaking-重要" class="router-link-active router-link-exact-active toc-link level2">Tree Shaking（重要）</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/frontend-service-station/webpack/3-senior.html#渐进式网络应用程序-pwa" class="router-link-active router-link-exact-active toc-link level2">渐进式网络应用程序 PWA</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/frontend-service-station/webpack/3-senior.html#shimming-预置依赖" class="router-link-active router-link-exact-active toc-link level2">Shimming 预置依赖</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/frontend-service-station/webpack/3-senior.html#shimming-预置全局变量" class="router-link-active router-link-exact-active toc-link level3">Shimming 预置全局变量</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/frontend-service-station/webpack/3-senior.html#细粒度-shimming" class="router-link-active router-link-exact-active toc-link level3">细粒度 Shimming</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/frontend-service-station/webpack/3-senior.html#全局-exports" class="router-link-active router-link-exact-active toc-link level3">全局 exports</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/frontend-service-station/webpack/3-senior.html#polyfills" class="router-link-active router-link-exact-active toc-link level3">Polyfills</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/frontend-service-station/webpack/3-senior.html#library-轮子" class="router-link-active router-link-exact-active toc-link level2">library 轮子</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/frontend-service-station/webpack/3-senior.html#npm-发布" class="router-link-active router-link-exact-active toc-link level2">npm 发布</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/frontend-service-station/webpack/3-senior.html#模块联邦-module-federation" class="router-link-active router-link-exact-active toc-link level2">模块联邦 Module Federation</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/frontend-service-station/webpack/3-senior.html#八个通用构建优化" class="router-link-active router-link-exact-active toc-link level2">八个通用构建优化</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/frontend-service-station/webpack/3-senior.html#_1-更新到最新版本" class="router-link-active router-link-exact-active toc-link level3">1.更新到最新版本</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/frontend-service-station/webpack/3-senior.html#_2-将-loader-应用于最少数量的必要模块" class="router-link-active router-link-exact-active toc-link level3">2.将 loader 应用于最少数量的必要模块</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/frontend-service-station/webpack/3-senior.html#_3-引导-bootstrap" class="router-link-active router-link-exact-active toc-link level3">3.引导 bootstrap</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/frontend-service-station/webpack/3-senior.html#_4-解析" class="router-link-active router-link-exact-active toc-link level3">4.解析</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/frontend-service-station/webpack/3-senior.html#_5-小即是快-smaller-faster" class="router-link-active router-link-exact-active toc-link level3">5.小即是快 smaller = faster</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/frontend-service-station/webpack/3-senior.html#_6-持久化缓存" class="router-link-active router-link-exact-active toc-link level3">6.持久化缓存</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/frontend-service-station/webpack/3-senior.html#_7-自定义-plugin-loader" class="router-link-active router-link-exact-active toc-link level3">7.自定义 plugin/loader</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/frontend-service-station/webpack/3-senior.html#_8-progress-plugin" class="router-link-active router-link-exact-active toc-link level3">8.progress plugin</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/frontend-service-station/webpack/3-senior.html#dll" class="router-link-active router-link-exact-active toc-link level2">DLL</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/frontend-service-station/webpack/3-senior.html#worker-池-worker-pool" class="router-link-active router-link-exact-active toc-link level2">worker 池(worker pool)</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/frontend-service-station/webpack/3-senior.html#开发环境构建性能" class="router-link-active router-link-exact-active toc-link level2">开发环境构建性能</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/frontend-service-station/webpack/3-senior.html#增量编译" class="router-link-active router-link-exact-active toc-link level3">增量编译</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/frontend-service-station/webpack/3-senior.html#内存中编译" class="router-link-active router-link-exact-active toc-link level3">内存中编译</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/frontend-service-station/webpack/3-senior.html#stats-tojson-加速" class="router-link-active router-link-exact-active toc-link level3">stats.toJson 加速</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/frontend-service-station/webpack/3-senior.html#devtool" class="router-link-active router-link-exact-active toc-link level3">devtool</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/frontend-service-station/webpack/3-senior.html#避免在生产环境使用-dev-工具" class="router-link-active router-link-exact-active toc-link level3">避免在生产环境使用 dev 工具</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/frontend-service-station/webpack/3-senior.html#最小化-entry-chunk" class="router-link-active router-link-exact-active toc-link level3">最小化 entry chunk</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/frontend-service-station/webpack/3-senior.html#避免额外的优化步骤" class="router-link-active router-link-exact-active toc-link level3">避免额外的优化步骤</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/frontend-service-station/webpack/3-senior.html#输出结果不携带路径信息" class="router-link-active router-link-exact-active toc-link level3">输出结果不携带路径信息</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/frontend-service-station/webpack/3-senior.html#node-js-版本-8-9-10-9-11-1" class="router-link-active router-link-exact-active toc-link level3">Node.js 版本 8.9.10 - 9.11.1</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/frontend-service-station/webpack/3-senior.html#typescript-loader" class="router-link-active router-link-exact-active toc-link level3">TypeScript Loader</a></li><!----><!--]--></ul><!--]--></ul></div></aside></div><!----><div class="theme-hope-content"><h2 id="source-map" tabindex="-1"><a class="header-anchor" href="#source-map" aria-hidden="true">#</a> source-map</h2><table><thead><tr><th style="text-align:left;">模式</th><th style="text-align:left;">解释</th></tr></thead><tbody><tr><td style="text-align:left;">eval</td><td style="text-align:left;">每个 module 会封装到 eval 里包裹起来执行，并且会在末尾追加注释 //@ sourceURL</td></tr><tr><td style="text-align:left;">source-map</td><td style="text-align:left;">生成一个 SourceMap 文件</td></tr><tr><td style="text-align:left;">hidden-source-map</td><td style="text-align:left;">和 source-map 一样，但不会在 bundle 末尾追加注释</td></tr><tr><td style="text-align:left;">inline-source-map</td><td style="text-align:left;">生成一个 DataUrl 形式的 SourceMap 文件</td></tr><tr><td style="text-align:left;">eval-source-map</td><td style="text-align:left;">每个 module 会通过 eval()来执行，并且生成一个 DataUrl 形式的 SourceMap</td></tr><tr><td style="text-align:left;">cheap-source-map</td><td style="text-align:left;">生成一个没有列信息（column-mappings）的 SourceMap 文件，不包含 loader 的 sourcemap（譬如 babel 的 sourcemap）</td></tr><tr><td style="text-align:left;">cheap-module-source-map</td><td style="text-align:left;">生成一个没有列信息（column-mappings）的 SourceMap 文件，同时 loader 的 sourcemap 也被简化为只包含对应行的</td></tr></tbody></table><p>eval：当 webpack.config 配置不定义 devtool 时，sourcemap 默认为 eval</p><p>一般最推荐的是 cheap-module-source-map，在 babel 支持下依然可以锁定行，但也简化了列</p><p>注意：</p><ol><li><p>生产环境一般不会开起 sourcemap 功能</p></li><li><p>通过 bundle 和 sourcemap 文件，可以反编译源码，存在暴露风险。</p></li><li><p>sourcemap 文件的体积相对巨大，跟生产环境追求更小更轻的 bundle 理念相悖。</p></li></ol><h2 id="dev-server" tabindex="-1"><a class="header-anchor" href="#dev-server" aria-hidden="true">#</a> dev-server</h2><p>static：指向当前服务的物理路径</p><p>compress：true 文件采用 gzip 压缩传输，增加 Content-Encoding：gzip</p><p>port：端口号</p><p>headers：配置任何想要的头部信息</p><p>proxy：开启代理</p><p>https：true 开启 https 服务，使用默认证书，浏览器报不安全</p><p>http2：true 与 https 同理，默认自带 https 自签名证书</p><p>historyApiFallback：true 解决 SPA 页面刷新报错，配合 publicPath：&#39;/&#39; 解决相对路径问题</p><p>host：&#39;0.0.0.0&#39;，局域网内其他同事可通过局域网 ip 访问你的服务</p><p><strong>不想在页面上显示报错覆盖</strong></p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token literal-property property">devServer</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">client</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">overlay</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="模块热替换与热加载" tabindex="-1"><a class="header-anchor" href="#模块热替换与热加载" aria-hidden="true">#</a> 模块热替换与热加载</h2><p>hot module replacement 功能会在应用程序运行过程中，替换、添加、删除模块，无需重新加载整个页面。</p><p>hot：true</p><p>热加载指的是文件更新时，自动刷新服务和页面，新版 webpack-dev-server 默认开启了热加载功能，参数</p><p>liveReload：true</p><p>关闭时两者需同时关闭</p><h2 id="eslint" tabindex="-1"><a class="header-anchor" href="#eslint" aria-hidden="true">#</a> eslint</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> eslint <span class="token parameter variable">-D</span>
eslint <span class="token parameter variable">--init</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>控制台 lint 示例</p><p><img src="https://misaka10032.oss-cn-chengdu.aliyuncs.com/Webpack/image-20220212192348030.png" alt="lint结果示例" loading="lazy"></p><p>最后会生成一个配置文件 .eslintrc.json ，这样就完成了 eslint 的基本规则配置。</p><ol><li><p>env：指定脚本的运行环境。每种环境都有一组特定的预定义全局变量，此处使用的 browser 预定义了浏览器环境中的全局变量，es6 启用除了 modules 以外的所有 ES6 特性。</p></li><li><p>globals：脚本执行期间访问的额外全局变量，即 env 中未预定义，但又需要使用的全局变量。</p></li><li><p>extends：检测中使用的预定义的规则集合。</p></li><li><p>rules：启用的规则及其各自的错误类别。会合并 extends 中的同名规则，定义冲突时优先级更高。</p></li><li><p>parserOptions：允许你指定你想要支持的 JS 语言选项。</p></li></ol><h2 id="git-hooks-与-husky" tabindex="-1"><a class="header-anchor" href="#git-hooks-与-husky" aria-hidden="true">#</a> git-hooks 与 husky</h2><p>设置 pre-commit 这个 git-hooks，在 commit 前进行 eslint 检查</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 设置githooks的文件夹配置路径</span>
<span class="token function">git</span> config core.hooksPath *****
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="模块与依赖" tabindex="-1"><a class="header-anchor" href="#模块与依赖" aria-hidden="true">#</a> 模块与依赖</h2><p><img src="https://misaka10032.oss-cn-chengdu.aliyuncs.com/Webpack/image-20220212204500370.png" alt="模块导入" loading="lazy"></p><p><img src="https://misaka10032.oss-cn-chengdu.aliyuncs.com/Webpack/image-20220212204713542.png" alt="模块依赖" loading="lazy"></p><p>模块都通过 compiler→resolvers→enhanced-resolve 这个解析器来解析</p><p>webpack 通过 Resolvers 实现了模块之间的依赖和引用，所引用的模块可以是来自应用程序的代码，也可以是第三方库，Resolver 帮助 webpack 从每个 require/import 语句中，找到需要引入到 bundle 中的模块代码，当打包模块时，webpack 使用 enhanced-resolve 来解析文件路径（webpack_resolver 的代码实现很有思想，webpack 基于此进行 tree-shaking）。</p><h3 id="模块路径解析规则" tabindex="-1"><a class="header-anchor" href="#模块路径解析规则" aria-hidden="true">#</a> 模块路径解析规则</h3><p>通过内置的 enhanced-resolve，webpack 能解析三种文件路径：</p><p>绝对路径、相对路径、模块路径</p><p>相对路径会根据给定的相对路径，用 path.resolve 拼接生成模块的绝对路径</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token literal-property property">resolve</span><span class="token operator">:</span> <span class="token punctuation">{</span>
	<span class="token literal-property property">alias</span><span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token string-property property">&#39;@&#39;</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#39;./src&#39;</span><span class="token punctuation">)</span>	<span class="token comment">//一般指向项目根目录下的src文件夹</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token literal-property property">extensions</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>	<span class="token comment">//扩展名优先级</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="外部扩展-externals" tabindex="-1"><a class="header-anchor" href="#外部扩展-externals" aria-hidden="true">#</a> 外部扩展 externals</h3><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token literal-property property">externalsType</span><span class="token operator">:</span> <span class="token string">&#39;script&#39;</span><span class="token punctuation">,</span>
<span class="token literal-property property">externals</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">jquery</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&#39;https://cdn.bootcdn.net/ajax/libs/jquery/3.6.0/jquery.js&#39;</span><span class="token punctuation">,</span>
    <span class="token string">&#39;$&#39;</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>通过将部分核心 js 依赖抽离到 externals 中，从外部 cdn 导入，实现压缩本地依赖大小的效果。</p><h3 id="依赖图-dependency-graph" tabindex="-1"><a class="header-anchor" href="#依赖图-dependency-graph" aria-hidden="true">#</a> 依赖图 dependency graph</h3><p>每当一个文件依赖另一个文件时，webpack 会直接将文件视为存在依赖关系。这使得 webpack 可以获取非代码资源，如 images 或 web 字体等。并会把它们作为依赖提供给应用程序。当 webpack 开始工作时，它会根据我们写好的配置，从入口（entry）开始，webpack 会递归地构建一个依赖关系图，这个依赖图包含应用程序中所需的每个模块，然后将所有模块打包为 bundle（output 的配置项）。</p><p>单纯讲似乎很抽象，我们更期望能够可视化打包产物的依赖图，下边列示了一些 bundle 分析工具。</p><p>webpack-chart：webpack stats 可交互饼图</p><p>webpack-visualizer：可视化并分析你的 bundle，检查哪些模块占空间，哪些可能是重复使用的。</p><p>webpack-bundle-analyzer：一个 plugin 和 CLI 工具，它将 bundle 内容展示为一个便捷的、交互式、可缩放的树状图形式。</p><p>webpack-bundle-optimize-helper：这个工具会分析你的 bundle，并提供可操作性的改进措施，以减少 bundle 的大小。</p><p>bundle-stats：生成一个 bundle 报告（bundle 大小、资源、模块），并比较不同构建之间的结果。</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> BundleAnalyzerPlugin <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;webpack-bundle-analyzer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 一般搭配npm run build执行生产环境的bundle检查</span>
<span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">BundleAnalyzerPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="扩展功能" tabindex="-1"><a class="header-anchor" href="#扩展功能" aria-hidden="true">#</a> 扩展功能</h2><h3 id="postcss-与-css-模块" tabindex="-1"><a class="header-anchor" href="#postcss-与-css-模块" aria-hidden="true">#</a> PostCSS 与 CSS 模块</h3><p>PostCSS：是一个用 JS 工具和插件转换 CSS 代码的工具，可以使用其中的 Autoprefixer 插件自动获取浏览器的流行度和能够支持的属性，并根据这些数据帮我们自动的为 CSS 规则添加前缀，将最新的 CSS 语法转换成大多数浏览器都能理解的语法</p><p>CSS 模块：能让你永远不用担心命名大众化而造成冲突，只要用最有意义的名字就行了</p><p>autoprefixer：为低版本浏览器提供 CSS3 属性兼容支持</p><p><img src="https://misaka10032.oss-cn-chengdu.aliyuncs.com/Webpack/image-20220213124026740.png" alt="autoprefixer" loading="lazy"></p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.css$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
      <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;style-loader&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;css-loader&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;postcss-loader&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>postcss-nested：在 CSS 文件中提供样式嵌套</p><p><img src="https://misaka10032.oss-cn-chengdu.aliyuncs.com/Webpack/image-20220213124733896.png" alt="postcss-nested" loading="lazy"></p><p>css-loader 开启模块化：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.css$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
      <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">&quot;style-loader&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">&quot;css-loader&quot;</span><span class="token punctuation">,</span>
          <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">modules</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">&quot;postcss-loader&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>从此 css 可通过 import 方式在其他模块文件中调用，以下是示例代码</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">import</span> style <span class="token keyword">from</span> <span class="token string">&quot;./app.css&quot;</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>style<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> div <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
div<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token string">&quot;hello postcss&quot;</span><span class="token punctuation">;</span>
div<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>style<span class="token punctuation">.</span>box<span class="token punctuation">)</span><span class="token punctuation">;</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>div<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="web-worker" tabindex="-1"><a class="header-anchor" href="#web-worker" aria-hidden="true">#</a> Web Worker</h3><p>webpack4 引入 web-worker 实现，webpack5 内置该模块</p><p>web worker 的本质是支持我们把数据刷新与页面渲染两个动作拆开执行，web worker 在其他线程单独执行，不影响主线程的 js 执行和页面渲染（不使用 web worker 的话这两个动作在主线程中是线性执行的）</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// worker部分 work.js</span>
self<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">message</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  self<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">answer</span><span class="token operator">:</span> <span class="token number">1111</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// 主进程部分</span>
<span class="token keyword">const</span> worker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span><span class="token string">&quot;./work.js&quot;</span><span class="token punctuation">,</span> <span class="token keyword">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>

worker<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">question</span><span class="token operator">:</span> <span class="token string">&quot;hi，那边的worker线程，请告诉我今天的幸运数字是多少？&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

worker<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">message</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="typescript" tabindex="-1"><a class="header-anchor" href="#typescript" aria-hidden="true">#</a> TypeScript</h3><p>ts 可以添加配置文件：tsconfig.json</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>tsc <span class="token parameter variable">--init</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>最终打包结果还是生成 js 文件，只是读取入口和 resolve 支持 ts 文件</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">&quot;development&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token string">&quot;./src/app.ts&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">devtool</span><span class="token operator">:</span> <span class="token string">&quot;inline-source-map&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.ts$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token string">&quot;ts-loader&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">exclude</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">resolve</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">extensions</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;.ts&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;.js&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&quot;bundle.js&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;./dist&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="多页面配置" tabindex="-1"><a class="header-anchor" href="#多页面配置" aria-hidden="true">#</a> 多页面配置</h2><p>通过加入多个 html-webpack-plugin 的模板 html 文件，实现不同入口文件的不同引入，减轻不同 html 的依赖体积</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">&#39;多页面应用&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">template</span><span class="token operator">:</span> <span class="token string">&#39;./index.html&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">inject</span><span class="token operator">:</span> <span class="token string">&#39;body&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&#39;chanel1/index.html&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">chunks</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;main&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;lodash&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">publicPath</span><span class="token operator">:</span> <span class="token string">&#39;http://www.b.com/&#39;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

<span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">template</span><span class="token operator">:</span> <span class="token string">&#39;./index2.html&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">inject</span><span class="token operator">:</span> <span class="token string">&#39;body&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&#39;chanel2/index2.html&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">chunks</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;main2&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;lodash&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">publicPath</span><span class="token operator">:</span> <span class="token string">&#39;http://www.a.com/&#39;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// 入口文件</span>
<span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">main</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token keyword">import</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;./src/app2.js&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;./src/app.js&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">dependOn</span><span class="token operator">:</span> <span class="token string">&#39;lodash&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&#39;chanel1/[name].js&#39;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">main2</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token keyword">import</span><span class="token operator">:</span> <span class="token string">&#39;./src/app3.js&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">dependOn</span><span class="token operator">:</span> <span class="token string">&#39;lodash&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&#39;chanel2/[name].js&#39;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">lodash</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token keyword">import</span><span class="token operator">:</span> <span class="token string">&#39;lodash&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&#39;common/[name].js&#39;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="tree-shaking-重要" tabindex="-1"><a class="header-anchor" href="#tree-shaking-重要" aria-hidden="true">#</a> Tree Shaking（重要）</h2><p><a href="https://www.jianshu.com/p/7994b1fc6dfe" target="_blank" rel="noopener noreferrer">tree-shaking 实战<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><a href="https://zhuanlan.zhihu.com/p/32831172" target="_blank" rel="noopener noreferrer">tree-shaking 实际作用分析<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>webpack5 新增属性 <strong>sideEffects</strong></p><p>package.json 中添加 sideEffects: false，可移除引入了但未使用的 css 文件等</p><p>sideEffects: [&#39; *.css &#39;, &#39; *.global.js &#39;]，数组内的相关格式文件在引入后均不会删除</p><h2 id="渐进式网络应用程序-pwa" tabindex="-1"><a class="header-anchor" href="#渐进式网络应用程序-pwa" aria-hidden="true">#</a> 渐进式网络应用程序 PWA</h2><p>PWA 主要作用是</p><p>安装必需插件并配置</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> workbox-webpack-plugin <span class="token parameter variable">-D</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> WorkboxPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;workbox-webpack-plugin&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">new</span> <span class="token class-name">WorkboxPlugin<span class="token punctuation">.</span>GenerateSW</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">clientsClaim</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            <span class="token literal-property property">skipWaiting</span><span class="token operator">:</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// index.js</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;serviceWorker&quot;</span> <span class="token keyword">in</span> navigator<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;load&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    navigator<span class="token punctuation">.</span>serviceWorker
      <span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token string">&quot;/service-worker.js&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">registration</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;SW 注册成功&quot;</span><span class="token punctuation">,</span> registration<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">registrationError</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;SW 注册失败&quot;</span><span class="token punctuation">,</span> registrationError<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;浏览器不支持serviceWorker!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>该技术适用于手机离线状态下的显示，会默认显示先前已显示的内容缓存不至于一片空白，但兼容性并不好目前主要在 Chrome 及其相关内核浏览器上可运行。</p><p>更多内容详见<a href="https://developer.mozilla.org/en-US/docs/Web/Progressive_web_apps" target="_blank" rel="noopener noreferrer">PWAs<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h2 id="shimming-预置依赖" tabindex="-1"><a class="header-anchor" href="#shimming-预置依赖" aria-hidden="true">#</a> Shimming 预置依赖</h2><h3 id="shimming-预置全局变量" tabindex="-1"><a class="header-anchor" href="#shimming-预置全局变量" aria-hidden="true">#</a> Shimming 预置全局变量</h3><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;html-webpack-plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;webpack&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">&quot;development&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token string">&quot;./src/index.js&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">// 提供全局变量</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>ProvidePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">_</span><span class="token operator">:</span> <span class="token string">&quot;lodash&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="细粒度-shimming" tabindex="-1"><a class="header-anchor" href="#细粒度-shimming" aria-hidden="true">#</a> 细粒度 Shimming</h3><p>一些遗留模块依赖的 this 指向的是 window 对象</p><p>当模块运行在 CJS 上下文中，此时的 module.exports 指向的是 module.exports</p><p>通过 imports-loader 覆盖 this 指向，其实就是变量注入</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> imports-loader <span class="token parameter variable">-D</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">test</span><span class="token operator">:</span> require<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&quot;./src/index.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token string">&quot;imports-loader?wrapper=window&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
      <span class="token literal-property property">exclude</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
      <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">&quot;babel-loader&quot;</span><span class="token punctuation">,</span>
          <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">presets</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;@babel/preset-env&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="全局-exports" tabindex="-1"><a class="header-anchor" href="#全局-exports" aria-hidden="true">#</a> 全局 exports</h3><p>当一些文件或变量没有默认的 module.exports 时，同样也能通过 exports-loader 实现文件/变量的导出</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> exports-loader <span class="token parameter variable">-D</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> exports-loader <span class="token parameter variable">-D</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token punctuation">{</span>
    <span class="token literal-property property">test</span><span class="token operator">:</span> require<span class="token punctuation">.</span><span class="token function">resole</span><span class="token punctuation">(</span><span class="token string">&#39;./src/global.js&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token string">&#39;exports-loader?type=commonjs&amp;exports=file,multiple|helpers.parse|parse&#39;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="polyfills" tabindex="-1"><a class="header-anchor" href="#polyfills" aria-hidden="true">#</a> Polyfills</h3><p>将高版本 ES6 转为低版本 ES5 语法</p><p>1.全局引入</p><p>在主 bundle 文件引入</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> <span class="token parameter variable">--save</span> @babel/polyfill
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token string">&quot;@babel/polyfill&quot;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>2.按需引入</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token punctuation">{</span>
  <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
  <span class="token literal-property property">exclude</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
  <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">&quot;babel-loader&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">presets</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">[</span>
            <span class="token string">&#39;@babel/preset-env&#39;</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
              <span class="token literal-property property">targets</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token string">&#39;last 1 version&#39;</span><span class="token punctuation">,</span>
                <span class="token string">&#39;&gt; 1%&#39;</span>
              <span class="token punctuation">]</span><span class="token punctuation">,</span>
              <span class="token literal-property property">corejs</span><span class="token operator">:</span> <span class="token string">&#39;3&#39;</span><span class="token punctuation">,</span>
              <span class="token literal-property property">useBuiltIns</span><span class="token operator">:</span> <span class="token string">&#39;usage&#39;</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">]</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="library-轮子" tabindex="-1"><a class="header-anchor" href="#library-轮子" aria-hidden="true">#</a> library 轮子</h2><p>普通 webpack 打包后的 js 文件只能通过被 script 标签引用而发挥作用，不能在其他环境中运行。因此需要更新 output 中的 library 配置项，保证能够在其他环境中也能正常调用。</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
	<span class="token literal-property property">path</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#39;dist&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&#39;mylib.js&#39;</span><span class="token punctuation">,</span>
	<span class="token literal-property property">library</span><span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;mylib&#39;</span><span class="token punctuation">,</span>
		<span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;window&#39;</span>	<span class="token comment">// &#39;commonjs&#39; &#39;module&#39;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>module 类型需要引入新的配置对象</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token literal-property property">experiments</span><span class="token operator">:</span> <span class="token punctuation">{</span>
	<span class="token literal-property property">outputModule</span><span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
	<span class="token literal-property property">path</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#39;dist&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&#39;mylib.js&#39;</span><span class="token punctuation">,</span>
	<span class="token literal-property property">library</span><span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;mylib&#39;</span><span class="token punctuation">,</span>
		<span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;module&#39;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="npm-发布" tabindex="-1"><a class="header-anchor" href="#npm-发布" aria-hidden="true">#</a> npm 发布</h2><ol><li>npm 仓库源检查</li></ol><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">npm</span> config get registry
// 确保registry仓库是npm官网仓库，不是淘宝镜像
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>打包文件检查</li></ol><p>npm 包名必须是全球唯一的，name 和 version 在 package.json 中设置。</p><p>发布的 npm 包以最终打包路径中的文件为准，需要调整 main 的路径</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token property">&quot;main&quot;</span><span class="token operator">:</span> <span class="token string">&quot;dist/index.js&quot;</span>	<span class="token comment">//注意：设置打包后路径</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="模块联邦-module-federation" tabindex="-1"><a class="header-anchor" href="#模块联邦-module-federation" aria-hidden="true">#</a> 模块联邦 Module Federation</h2><p>以下是常见的模块化方式共享模块的概念，模块联邦实际上很类似微前端方式的概念</p><p><img src="https://misaka10032.oss-cn-chengdu.aliyuncs.com/Webpack/image-20220213214659805.png" alt="npm方式共享模块" loading="lazy"></p><p><img src="https://misaka10032.oss-cn-chengdu.aliyuncs.com/Webpack/image-20220213214731528.png" alt="umd方式共享模块" loading="lazy"></p><p><img src="https://misaka10032.oss-cn-chengdu.aliyuncs.com/Webpack/image-20220213214820666.png" alt="微前端方式共享模块" loading="lazy"></p><p><img src="https://misaka10032.oss-cn-chengdu.aliyuncs.com/Webpack/image-20220213214859207.png" alt="模块联邦方式共享模块" loading="lazy"></p><p>配置写法</p><p>Nav 部分</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> ModuleFederationPlugin <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;webpack&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>container<span class="token punctuation">;</span>

<span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

  <span class="token keyword">new</span> <span class="token class-name">ModuleFederationPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;nav&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&quot;remoteEntry.js&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">remotes</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">exposes</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string-property property">&quot;./Header&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./src/Header.js&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">shared</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Home 部分</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> ModuleFederationPlugin <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;webpack&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>container<span class="token punctuation">;</span>

<span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

  <span class="token keyword">new</span> <span class="token class-name">ModuleFederationPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;home&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&quot;remoteEntry.js&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">remotes</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">nav</span><span class="token operator">:</span> <span class="token string">&quot;nav@http://localhost:8080/remoteEntry.js&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">exposes</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">homeList</span><span class="token operator">:</span> <span class="token string">&quot;homeList@http://localhost:8081/remoteEntry.js&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">shared</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">&quot;nav/Header&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="八个通用构建优化" tabindex="-1"><a class="header-anchor" href="#八个通用构建优化" aria-hidden="true">#</a> 八个通用构建优化</h2><h3 id="_1-更新到最新版本" tabindex="-1"><a class="header-anchor" href="#_1-更新到最新版本" aria-hidden="true">#</a> 1.更新到最新版本</h3><p>webpack v5.61.0 Node.js v16.13.0</p><h3 id="_2-将-loader-应用于最少数量的必要模块" tabindex="-1"><a class="header-anchor" href="#_2-将-loader-应用于最少数量的必要模块" aria-hidden="true">#</a> 2.将 loader 应用于最少数量的必要模块</h3><p>提供 include 和 exclude，尽量少 loader 模块</p><h3 id="_3-引导-bootstrap" tabindex="-1"><a class="header-anchor" href="#_3-引导-bootstrap" aria-hidden="true">#</a> 3.引导 bootstrap</h3><p>每个额外的 loader/plugin 都有启动时间。尽量少使用</p><h3 id="_4-解析" tabindex="-1"><a class="header-anchor" href="#_4-解析" aria-hidden="true">#</a> 4.解析</h3><p>以下步骤可以提高解析速度：</p><ul><li><p>减少 resolve.modules, resolve.extensions, resolve.mainFiles, resolve.descriptionFiles 中条目数量，因为它们会增加文件系统调用次数</p></li><li><p>如果你不适用 symlinks(例如 npm link 或者 yarn link)，可以设置 resolve.symlinks: false（实际上就是取消软连接）</p></li><li><p>如果你使用自定义 resolve plugin 规则，并且没有指定 context 上下文，可以设置 resolve.cacheWithContext: false</p></li></ul><h3 id="_5-小即是快-smaller-faster" tabindex="-1"><a class="header-anchor" href="#_5-小即是快-smaller-faster" aria-hidden="true">#</a> 5.小即是快 smaller = faster</h3><p>减少编译结果的整体大小，以提高构建性能。尽量保持 chunk 体积小。</p><ul><li>使用数量更少/体积更小的 library。</li><li>在多页面应用中使用 SplitChunksPlugin。</li><li>在多页面应用中使用 SplitChunksPlugin，并开启 async 模式。</li><li>移除未引用代码。</li><li>只编译你当前正在开发的那些代码。</li></ul><h3 id="_6-持久化缓存" tabindex="-1"><a class="header-anchor" href="#_6-持久化缓存" aria-hidden="true">#</a> 6.持久化缓存</h3><p>在 webpack 配置中使用 cache 选项。使用 package.json 中的 postinstall 清除缓存目录。</p><p>将 cache 类型设置为内存或者文件系统。memory 选项告诉 webpack 在内存中存储缓存，不允许额外的配置。</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
	<span class="token operator">...</span>
	<span class="token literal-property property">cache</span><span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;memory&#39;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_7-自定义-plugin-loader" tabindex="-1"><a class="header-anchor" href="#_7-自定义-plugin-loader" aria-hidden="true">#</a> 7.自定义 plugin/loader</h3><p>对它们进行概要分析，以免在此处引入性能问题。</p><h3 id="_8-progress-plugin" tabindex="-1"><a class="header-anchor" href="#_8-progress-plugin" aria-hidden="true">#</a> 8.progress plugin</h3><p>将 ProgressPlugin 从 webpack 中删除，可以缩短构建时间。该插件不会为快速构建提供太多价值，请权衡利弊再使用。</p><h2 id="dll" tabindex="-1"><a class="header-anchor" href="#dll" aria-hidden="true">#</a> DLL</h2><p>使用 DllPlugin 为更改不频繁的代码生成单独的编译结果。可以提高应用程序的编译速度，尽管它增加了构建过程的复杂度。</p><p>通常编译的代码为项目的核心编译框架 orUI 框架代码</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// webpack.dll.config.js</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;webpack&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">&quot;production&quot;</span><span class="token punctuation">,</span>

  <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">lodash</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;lodash&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&quot;[name].js&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;dll&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">library</span><span class="token operator">:</span> <span class="token string">&quot;[name]_[hash]&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DllPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;[name]_[hash]&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">path</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;dll/manifest.json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token comment">// package.json</span>
<span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;http-server dist&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;dev&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack serve&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;dll&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack --config ./webpack.dll.config.js&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>执行结果：</p><p><img src="https://misaka10032.oss-cn-chengdu.aliyuncs.com/Webpack/image-20220214235807888.png" alt="dll执行结果" loading="lazy"></p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// webpack.config.js dll加入到项目中</span>
<span class="token keyword">const</span> AddAssetHtmlPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;add-asset-html-webpack-plugin&#39;</span><span class="token punctuation">)</span>

<span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DllReferencePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">manifest</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#39;./dll/manifest.json&#39;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">AddAssetHtmlPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">filepath</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#39;./dll/lodash.js&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">publicPath</span><span class="token operator">:</span> <span class="token string">&#39;./&#39;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>注意，其本质就是提前将大型静态组件打包，导出 hash 值，项目打包时引入 hash 值直接导入已打包好的代码，加快打包速度。</p><h2 id="worker-池-worker-pool" tabindex="-1"><a class="header-anchor" href="#worker-池-worker-pool" aria-hidden="true">#</a> worker 池(worker pool)</h2><p>thread-loader 可以将非常消耗资源的 loader 分流给一个 worker pool</p><p>不要使用太多的 worker，因为 Nodejs 的 runtime 和 loader 都有启动开销，最小化 worker 和 main process（主进程）之间的模块传输，进程间通讯(IPC)是非常消耗资源的。</p><h2 id="开发环境构建性能" tabindex="-1"><a class="header-anchor" href="#开发环境构建性能" aria-hidden="true">#</a> 开发环境构建性能</h2><h3 id="增量编译" tabindex="-1"><a class="header-anchor" href="#增量编译" aria-hidden="true">#</a> 增量编译</h3><p>使用 webpack 的 watch mode（监听模式），而不使用其他工具来 watch 文件和调用 webpack。内置的 watch mode 会记录时间戳并将此信息传递给 compilation 以使缓存失效。</p><p>在某些配置环境中，watch mode 会回退到 poll mode（轮询模式）。监听许多文件会导致 CPU 大量负载。在这些情况下，可以使用 watchOptions.poll 来增加轮询的间隔时间。</p><h3 id="内存中编译" tabindex="-1"><a class="header-anchor" href="#内存中编译" aria-hidden="true">#</a> 内存中编译</h3><p>下面几个工具通过在内存中（而不是写入磁盘）编译和 serve 资源来提高性能：</p><ul><li><p>webpack-dev-server</p></li><li><p>webpack-hot-middleware</p></li><li><p>webpack-dev-middleware</p></li></ul><h3 id="stats-tojson-加速" tabindex="-1"><a class="header-anchor" href="#stats-tojson-加速" aria-hidden="true">#</a> stats.toJson 加速</h3><p>webpack4 默认使用 stats.toJson()输出大量数据。除非在增量步骤中做必要的统计，否则请避免获取 stats 对象的部分内容。</p><p>webpack-dev-server 在 v3.1.3 以后的版本，包含一个重要的性能修复，即最小化每个增量构建步骤中，从 stats 对象获取的数据量。</p><h3 id="devtool" tabindex="-1"><a class="header-anchor" href="#devtool" aria-hidden="true">#</a> devtool</h3><p>需要注意的是不同的 devtool 设置，会导致性能差异。</p><ul><li><p>eval 具有最好的性能，但并不能帮助你转译代码。</p></li><li><p>如果你能接受稍差一些的 map 质量，可以使用 cheap-source-map 变体配置来提高性能。</p></li><li><p>使用 eval-source-map 变体配置进行增量编译。</p></li></ul><p>在大多数情况下，最佳选择是 eval-cheap-module-source-map</p><h3 id="避免在生产环境使用-dev-工具" tabindex="-1"><a class="header-anchor" href="#避免在生产环境使用-dev-工具" aria-hidden="true">#</a> 避免在生产环境使用 dev 工具</h3><p>某些 utility, plugin 和 loader 都只用于生产环境，在开发环境下，应该排除以下工具：</p><ul><li>TerserPlugin</li><li><code>[fullhash]/[chunkhash]/[contenthash]</code></li><li>AggressiveSplittingPlugin</li><li>AggressiveMergingPlugin</li><li>ModuleConcatenationPlugin</li></ul><h3 id="最小化-entry-chunk" tabindex="-1"><a class="header-anchor" href="#最小化-entry-chunk" aria-hidden="true">#</a> 最小化 entry chunk</h3><p>webpack 只会在文件系统中输出已经更新的 chunk。某些配置选项（HMR, output.chunkFileName 的 <code>[fullhash]/[chunkhash]/[contenthash]</code>, <code>[fullhash]</code>来说，除了对已经更新的 chunk 无效之外，对于 entry chunk 也不会生效）</p><p>确保在生成 entry chunk 时，尽量减少其体积以提高性能，下面的配置为运行时代码创建了一个额外的 chunk，所以它的生成代价较低：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token literal-property property">optimization</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">runtimeChunk</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="避免额外的优化步骤" tabindex="-1"><a class="header-anchor" href="#避免额外的优化步骤" aria-hidden="true">#</a> 避免额外的优化步骤</h3><p>webpack 通过执行额外的算法任务，来优化输出结果的体积和加载性能。这些优化适用于小型代码库，但是在大型代码库中却非常耗费性能</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>modules<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token literal-property property">optimization</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">removeAvailableModules</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token literal-property property">removeEmptyChunks</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token literal-property property">splitChunks</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="输出结果不携带路径信息" tabindex="-1"><a class="header-anchor" href="#输出结果不携带路径信息" aria-hidden="true">#</a> 输出结果不携带路径信息</h3><p>webpack 会在输出的 bundle 中生成路径信息，然而在打包数千个模块的项目中，会导致垃圾回收性能压力。在 options.output.pathinfo 设置中关闭</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">pathinfo</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="node-js-版本-8-9-10-9-11-1" tabindex="-1"><a class="header-anchor" href="#node-js-版本-8-9-10-9-11-1" aria-hidden="true">#</a> Node.js 版本 8.9.10 - 9.11.1</h3><p>Node.js v8.9.10 - v9.11.1 中的 ES2015 Map 和 Set 实现，存在性能回退。webpack 大量地使用这些数据结构，因此这次回退也会影响编译时间。之前和之后的 Node.js 版本不受影响。</p><h3 id="typescript-loader" tabindex="-1"><a class="header-anchor" href="#typescript-loader" aria-hidden="true">#</a> TypeScript Loader</h3><p>你可以为 loader 传入 transpileOnly 选项，以缩短使用 ts-loader 时的构建时间。使用此选项，会关闭类型检查。如果要再次开启类型检查，请使用 ForkTsCheckerWebpackPlugin。使用此插件会将检查过程转移至单独的进程，可以加快 TypeScript 的类型检查和 ESLint 插入的速度。</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.tsx?$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
  <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">&quot;ts-loader&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">transpileOnly</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>生产环境优化构建性能主要考虑关闭 source-map。</p></div><!----><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/mi-saka10032/frontend-service-station/edit/main/demo/theme-docs/src/webpack/3-senior.md" rel="noopener noreferrer" target="_blank" aria-label="Edit this page on GitHub" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->Edit this page on GitHub<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item update-time"><span class="label">Last update: </span><!----></div><div class="meta-item contributors"><span class="label">Contributors: </span><!--[--><!--[--><span class="contributor" title="email: misaka10032@aliyun.com">yuzhihang</span><!--]--><!--]--></div></footer><nav class="page-nav"><a href="/frontend-service-station/webpack/2-primary.html" class="nav-link prev" aria-label="webpack基础配置"><div class="hint"><span class="arrow left"></span>Prev</div><div class="link"><!---->webpack基础配置</div></a><a href="/frontend-service-station/webpack/4-webpack%E5%8E%9F%E7%90%86.html" class="nav-link next" aria-label="Webpack原理"><div class="hint">Next<span class="arrow right"></span></div><div class="link">Webpack原理<!----></div></a></nav><!----><!----><!--]--></main><!--]--><!----><!--]--></div><!--]--><!----><!----><!--]--></div>
    <script type="module" src="/frontend-service-station/assets/app.c9ae6438.js" defer></script>
  </body>
</html>
